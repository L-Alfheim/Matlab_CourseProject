---

# **同乡通讯录系统 - 前端设计文档**

## **项目概述**
本系统是一个基于 MATLAB App Designer 开发的同乡通讯录管理系统，支持人员信息的录入、查询、显示和导出功能。前端通过 TCP 协议与后端数据库服务通信，实现数据的实时交互。

---

## **一、界面布局与组件说明**

### **1.1 整体布局**
- 采用左右分栏设计，左侧为信息录入区，右侧为查询与结果显示区。
- 支持响应式布局，当窗口宽度小于阈值时自动切换为上下布局。

### **1.2 左侧面板（LeftPanel）**
| 组件类型 | 变量名 | 说明 |
|----------|--------|------|
| `EditField` | `EditField` | 输入姓名 |
| `DatePicker` | `DatePicker` | 选择出生年月（格式：yyyy-MM） |
| `EditField` | `EditField_3` | 输入电话号码（仅限数字） |
| `EditField` | `EditField_4` | 输入籍贯信息 |
| `Button` | `Button_2` | 点击执行信息录入 |
| `Image` | `Image` | 显示人员头像 |
| `Button` | `Button_3` | 上传图片按钮 |

### **1.3 右侧面板（RightPanel）**
| 组件类型 | 变量名 | 说明 |
|----------|--------|------|
| `EditField` | `EditField_5` | 输入查询姓名（支持模糊查询） |
| `Button` | `Button` | 执行查询操作 |
| `UITable` | `UITable` | 显示查询结果（姓名、出生年月、电话、籍贯） |
| `TextArea` | `TextArea` | 显示执行结果或错误信息 |
| `Button` | `PDFButton` | 导出查询结果为 PDF 文件 |

---

## **二、功能模块说明**

### **2.1 信息录入（INSERT）**
- 用户填写姓名、出生年月、电话、籍贯，并上传头像。
- 点击“录入”按钮后，将数据打包为 TCP 报文发送至服务器。
- 支持图片二进制传输，格式为 `header + 图片数据`。

### **2.2 信息查询（SELECT）**
- **单条查询**：在右侧输入姓名，点击“查询”，返回匹配的第一条记录（含头像）。
- **全部查询**：查询条件为空时，返回所有人员信息（不含头像），以表格形式展示。

### **2.3 数据导出（PDF）**
- 将当前表格中的数据导出为 PDF 报告，包含表格标题和样式。
- 使用 `mlreportgen` 库生成格式规范的 PDF 文件。

### **2.4 图片上传与显示**
- 支持常见图片格式（jpg、png、bmp、tif）。
- 图片以临时文件方式读取并显示在 `uiimage` 组件中。

---

## **三、通信机制**

### **3.1 TCP 连接**
- 启动时自动连接本地 TCP 服务（127.0.0.1:1642）。
- 使用定时器（`commTimer`）每 50ms 检查一次数据收发。

### **3.2 报文格式**
采用自定义的 **header + body** 格式：
```
command=INSERT
name=张三
birthday=2000-01
phone=13800138000
address=北京
fileName=avatar.png
fileSize=1024
END_HEADER
[图片二进制数据]
```

### **3.3 状态标志（SELECT_Mark）**
- `0`：普通响应（如 INSERT 结果）
- `1`：单条查询响应（含图片）
- `2`：全部查询响应（多条记录，无图片）

---

## **四、错误处理与用户提示**
- 使用 `TextArea` 显示操作结果（成功/失败/错误信息）。
- 网络异常、数据解析失败等情况均有友好提示。
- 图片读取失败时显示默认白色图像。

---

## **五、代码结构摘要**

### **5.1 主要私有方法**
| 方法名 | 功能 |
|--------|------|
| `tcpLoop()` | TCP 通信循环，处理收发逻辑 |
| `parseAndUpdateTable(msg)` | 解析查询结果并更新表格 |
| `TCPSever()` | 建立 TCP 连接并启动定时器 |
| `AppClose()` | 关闭 TCP 和定时器，清理资源 |

### **5.2 回调函数**
| 回调函数 | 功能 |
|----------|------|
| `Select()` | 处理查询请求 |
| `INSERT()` | 处理录入请求 |
| `ImageUpdate()` | 处理图片上传 |
| `printPDF()` | 生成 PDF 报告 |

---

## **六、运行环境**
- **平台**：MATLAB R2020a 或更高版本
- **依赖工具箱**：
  - `mlreportgen`（用于 PDF 导出）
  - `Image Processing Toolbox`（用于图片处理）

---

## **七、注意事项**
- 需确保后端 TCP 服务已启动并监听指定端口。
- 图片传输依赖临时文件，需确保系统有写入权限。
- 表格数据解析依赖于固定的字段顺序（姓名、出生年月、电话、籍贯）。

---