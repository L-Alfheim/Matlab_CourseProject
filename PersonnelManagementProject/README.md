# 人员通讯录系统 - 总文档

## 项目概述

人员通讯录系统是一个基于客户端-服务器架构的信息管理系统，支持人员基本信息（姓名、出生年月、电话、籍贯）及头像的录入、查询、显示和导出功能。系统前端采用MATLAB App Designer开发，后端基于Java实现，通过TCP协议进行实时通信，使用SQLite数据库进行数据持久化存储。

### 技术架构

* **前端**：MATLAB App Designer
* **后端**：Java
* **数据库**：SQLite
* **通信协议**：TCP Socket（自定义协议）
* **数据交互**：文本协议+二进制传输

## 系统功能

### 核心功能

1. **信息录入**：支持填写人员基本信息及上传头像
2. **信息查询**：支持单条查询（含头像）和全部查询（列表展示）
3. **数据导出**：可将查询结果导出为PDF文件
4. **数据管理**：后端支持数据的插入、查询、更新和删除操作

### 功能流程

1. 前端启动时自动连接后端TCP服务（127.0.0.1:1642）
2. 用户通过前端界面进行信息录入或查询操作
3. 前端将操作封装为特定格式的TCP报文发送至后端
4. 后端处理请求并与数据库交互，返回响应结果
5. 前端接收并解析响应，更新界面展示

## 系统组件

### 前端组件（MATLAB App Designer）

#### 界面布局

* 左侧面板（信息录入区）：包含姓名输入框、出生年月选择器、电话输入框、籍贯输入框、录入按钮、头像显示区和图片上传按钮
* 右侧面板（查询与显示区）：包含查询输入框、查询按钮、结果表格、信息提示区和PDF导出按钮

#### 核心方法

* `tcpLoop()`：TCP通信循环，处理数据收发逻辑
* `parseAndUpdateTable(msg)`：解析查询结果并更新表格
* `TCPSever()`：建立TCP连接并启动定时器
* `AppClose()`：关闭TCP连接和定时器，清理资源

#### 回调函数

* `Select()`：处理查询请求
* `INSERT()`：处理录入请求
* `ImageUpdate()`：处理图片上传
* `printPDF()`：生成PDF报告

### 后端组件（Java）

#### 架构分层

1. **数据库接口层**：定义数据库操作标准接口及SQLite实现
2. **业务逻辑层**：封装人员信息及处理逻辑
3. **网络服务层**：多线程Socket服务器，处理客户端连接和请求

#### 核心类

* `DatabaseIO`接口及`SQLite`实现类：数据库操作
* `PersonPackageIO`接口及`PersonPackage`实现类：人员信息处理
* `JavaServer`类：TCP服务器，处理客户端连接和命令分发

## 通信协议

### 协议格式

采用**header + body**格式，支持文本命令和二进制数据传输

#### 请求格式（客户端→服务器）

```
command=INSERT
name=张三
birthday=2000-01
phone=13800138000
address=北京
fileName=avatar.png
fileSize=1024
END\_HEADER
\[图片二进制数据]
```

#### 响应格式（服务器→客户端）

* 文本响应（操作结果）：`数据插入成功`
* 数据包响应（查询结果）：


	command=SingleOut
	name=张三
	phone=13800138000
	birthday=1990-01-01
	address=北京市
	fileName=img\_1234567890.png
	fileSize=1024
	END\_HEADER
	\[二进制图片数据]


#### 支持的命令

| 命令 		| 功能				| 说明						|
|-----------|---------------|-------------------------------|
|`INSERT`	|插入、更新人员信息	|包含基本信息和图片数据			|
|`SELECT`	|查询单个人员		|按姓名查询，返回完整信息及头像	|
|`SELECTall`|查询所有人员		|返回所有人员基本信息，不含头像	|
|`DELETE`	|删除人员信息		|按姓名删除指定人员信息			|

## 数据库设计

### 数据表结构

#### Person表（人员基本信息）

|字段		|类型					|说明			|
|-----------|-----------------------|--------------|
|id			|INTEGER PRIMARY KEY	|自增主键		|
|Name		|TEXT					|姓名(唯一)		|
|phoneNumber|TEXT					|电话号码		|
|Birthday	|TEXT					|生日			|
|Address	|TEXT					|地址			|

#### FaceRecord表（头像信息）

| 字段 | 类型 | 说明 |
|------|------|------|
| id | INTEGER PRIMARY KEY | 自增主键 |
| personid | INTEGER | 关联Person.id |
| imageURL | TEXT | 图片存储路径 |

## 运行环境

### 前端环境

* MATLAB R2020a 或更高版本
* 依赖工具箱：`mlreportgen`（PDF导出）、`Image Processing Toolbox`（图片处理）

### 后端环境

* Java 8+
* SQLite JDBC驱动
* 磁盘写入权限（用于图片存储）

## 使用说明

### 启动步骤

1. 启动后端服务器：运行`JavaServer.main()`方法
2. 启动前端应用：在MATLAB中运行App Designer应用
3. 系统自动建立TCP连接，连接成功后即可使用各项功能

### 操作流程

1. **信息录入**：

   * 填写左侧面板中的人员信息
   * 点击"上传图片"按钮选择头像
   * 点击"录入"按钮提交信息

2. **信息查询**：

   * 在右侧查询框输入姓名（支持模糊查询）
   * 点击"查询"按钮获取结果
   * 若查询框为空，将返回所有人员信息

3. **数据导出**：

   * 查询结果显示在表格中后，点击"导出PDF"按钮
   * 选择保存路径，生成PDF报告

## 注意事项

1. 确保后端服务先于前端启动，且监听端口1642
2. 图片传输依赖临时文件，需确保系统有写入权限
3. 数据库文件位于`database/Person.db`，图片存储于`database/images/`
4. 所有文本数据采用UTF-8编码，避免乱码问题
5. 姓名为唯一标识，用于数据的查询和更新操作

## 异常处理

* 网络异常：前端提示"连接失败，请检查服务器是否启动"
* 数据解析失败：显示详细错误信息，提示用户检查输入格式
* 图片读取失败：显示默认白色图像，并提示用户重新上传
* 数据库错误：后端记录错误日志，前端显示友好提示信息

---

